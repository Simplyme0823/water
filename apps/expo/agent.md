一日三餐饮食记录 App PRD（Expo iOS）

背景与目标
- 背景：用户希望以低门槛方式记录每日三餐，减少手动输入成本，并能回顾饮食结构与基础营养情况。
- 目标：用拍照 + 对话的方式快速记录三餐，并在本地形成可回溯的饮食记录与 AI 营养分析结果。
- 成功指标（MVP）：
  - 记录完成率：用户开始记录后，单次记录完成率 ≥ 80%。
  - 记录耗时：从打开记录到保存 ≤ 60 秒（含识别与确认）。
  - 留存：7 日内至少记录 3 天的用户占比 ≥ 30%。

用户画像
- 健康管理初级用户：想了解饮食规律但不愿复杂输入。
- 轻度记录者：需要基础营养分析与建议，但不追求医学级精准度。

核心场景
- 早餐/午餐/晚餐结束后，拍照并在聊天中确认识别结果，完成记录。
- 记录完成后，查看 AI 输出的营养分析摘要与简单建议。
- 回顾一天/一周的饮食记录，查看三餐结构与简要统计。

产品范围（MVP）
- iOS 端（Expo）单机应用，Android 暂不考虑。
- 使用 @tansui/core 进行图片识别。
- 使用 @tansui/core 进行营养分析（基于识别结果与用户修订内容）。
- 聊天数据与饮食记录均存储在本地。

非目标
- 云端同步与多设备登录。
- 医学级营养规划或疾病管理功能。
- 社交分享与社区功能。
- Android 应用支持。

信息架构
- 首页：今日三餐概览 + 快速记录入口。
- 记录页：拍照/相册选择 -> 识别 -> 对话确认 -> 保存。
- 历史页：日/周视图、筛选、详情查看。
- 详情页：单条记录详情、编辑、删除。
- 设置页：模型与 API Key 配置、清空本地数据。

UI 风格
- 视觉基调：清爽、轻量、温暖的健康感，强调“记录而非评判”。
- 色彩
  - 主色：鼠尾草绿（示例 #5B8C5A），用于主按钮与关键状态。
  - 强调色：杏橙（示例 #F2A65A），用于营养摘要与提示。
  - 背景：米白（示例 #F8F5F0），减少纯白刺眼感。
  - 文本：深灰（示例 #2E2E2E），辅助文本使用中灰。
- 字体
  - 标题：Noto Serif SC（或 Source Han Serif SC），正文：Noto Sans SC（或 Source Han Sans SC）。
  - 未加载自定义字体时，回退至 iOS 默认字体。
- 布局与组件
  - 卡片式内容承载，圆角 12-16，阴影轻微。
  - 首页大按钮入口，记录页以图片为中心，聊天气泡简洁对齐。
  - 营养摘要采用简洁条形或环形占比图，避免过度复杂。
- 动效与反馈
  - 页面进入淡入 + 轻微上浮；列表分段渐入。
  - 关键操作提供轻触觉反馈（如保存成功）。
- 图标与插图
  - 线性图标为主，笔触 1.5px，圆角端点。
  - 食物照片保持自然光感，避免重滤镜。

关键流程
- 记录流程
  - 用户选择拍照或相册 -> 调用 @tansui/core 识别图片 -> 进入聊天确认 -> 保存到本地。
- 回顾流程
  - 进入历史页 -> 选择日期/范围 -> 查看三餐记录 -> 进入详情。

交互流程（MVP）
- 首次进入
  - 引导用户进入设置页配置云端模型与 API Key，可选择稍后配置。
  - 未配置时允许浏览历史与手动记录，但提示识别与营养分析不可用。
- 记录三餐
  - 首页点击“记录” -> 选择拍照或相册 -> 预览确认。
  - 调用 @tansui/core 识别图片并进入聊天页展示识别结果。
  - 用户在聊天中确认/修改菜品、分量、餐别与备注。
  - 确认后触发营养分析并展示摘要与建议。
  - 用户点击“保存”，回到首页并更新今日概览。
- 编辑与补录
  - 历史页进入详情 -> 编辑菜品或分量 -> 重新生成营养分析 -> 保存更新。
- 离线与失败处理
  - 无网络或调用失败时，提示“仅保存未识别记录”，允许稍后补全。
  - 恢复网络后在详情页触发重新识别/分析。
- 设置与数据管理
  - 设置页支持修改模型与 API Key、清空本地数据（需二次确认）。

功能需求
- 记录方式
  - 拍照与相册导入。
  - 支持手动补充/修改识别结果（菜品名称、分量/备注）。
- 识别与解析（@tansui/core）
  - 识别输出至少包含菜品名称与可能的餐别建议。
  - 识别结果必须可编辑，并要求用户确认后才可保存。
- 聊天式交互
  - 识别结果以对话形式展示，支持“确认/修改/补充”。
  - 聊天记录按单次记录维度存储，可在详情页查看。
- 记录管理
  - 支持编辑、删除、追加备注（如地点、心情、是否外卖）。
  - 自动按时间归类为早餐/午餐/晚餐，用户可手动调整。
- 营养分析（AI）
  - 基于识别/修订后的菜品与分量输出菜品级营养成分与单餐汇总（由 @tansui/core 生成）。
  - 菜品级至少包含热量与宏量营养素（蛋白质/脂肪/碳水），并包含膳食纤维、糖、钠。
  - 结果需标注为“估算”，并允许用户手动修订或关闭显示。
  - 记录详情页展示本次营养摘要与简短建议。
- 历史与统计（轻量）
  - 日视图展示三餐条目与缩略图。
  - 周视图展示记录天数与餐别覆盖情况（简单统计即可）。
  - 可选展示每日/每周营养概览（总热量与宏量营养素占比）。
- 提醒（可选，MVP 末期）
  - 设定用餐时段提醒，默认关闭。

数据与存储
- 本地存储
  - 记录数据、聊天记录与营养分析结果存于本地数据库（SQLite / expo-sqlite）。
  - 图片可存本地文件系统并在数据库保存引用。
  - 模型配置与 API Key 本地保存。
- 数据结构（概念级）
  - MealEntry：时间、餐别、图片引用、识别结果、用户修订内容、营养分析、备注、对话记录。
  - NutritionAnalysis：菜品级营养成分、单餐汇总、估算范围/置信度、建议文本。
  - 营养字段定义（菜品级与单餐汇总通用）
    - kcal：热量，单位千卡（kcal）。
    - protein_g：蛋白质含量，单位克（g）。
    - fat_g：脂肪含量，单位克（g）。
    - carb_g：碳水化合物含量，单位克（g）。
    - fiber_g：膳食纤维含量，单位克（g）。
    - sugar_g：糖含量，单位克（g）。
    - sodium_mg：钠含量，单位毫克（mg）。
- 隐私
  - 默认不上传图片与聊天数据到服务器。
  - 所有 AI 能力通过 @tansui/core 调用，并明确告知用户数据使用范围。
  - 仅发送结构化菜品与分量信息用于云端模型推理。
  - 提供“清空本地数据”入口。

业务规则
- 餐别默认规则（可配置）
  - 05:00-10:30 早餐，10:31-15:00 午餐，15:01-21:00 晚餐，其余为加餐。
- 同一餐别允许多条记录，但需提示用户确认避免误记。

非功能需求
- 性能：单次识别 + 确认流程在网络可用时 ≤ 10 秒内响应（不含用户操作）。
- 离线：本地浏览与历史查看离线可用；离线时允许保存“未识别”记录，待补全。
- 兼容：iOS 16+，适配主流屏幕尺寸。

技术约束
- 使用 Expo 构建 iOS 应用。
- UI 样式使用 NativeWind（Tailwind 语法适配 React Native）。
- 图片识别必须通过 @tansui/core。
- 营养分析由 @tansui/core 完成，输入基于识别与用户修订后的结果。
- AI 模型来源为云端，用户在设置页配置模型与 API Key。
- 聊天数据与饮食记录仅本地存储。

风险与依赖
- 识别效果不稳定：需设计低成本的手动补录流程。
- 营养分析误差：需提示“估算”并降低误导风险。
- 图片存储空间占用：需控制图片压缩与缓存策略。
- @tansui/core 的性能与接口稳定性。
- 云端模型与 API Key 配置体验（可用性与安全性）。

里程碑（建议）
- M1：信息架构与交互原型完成。
- M2：识别 + 聊天确认闭环打通（本地存储）。
- M3：历史回顾与基础统计完成。
- M4：体验优化与性能稳定。

待确认问题
